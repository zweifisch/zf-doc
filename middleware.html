<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title></title>
	<link rel="stylesheet" href="assets/style.css" />
	<link rel="stylesheet" href="assets/github.css" />
</head>
<body>

	<div class="container">
		<div class="navigation-menu">

			<ul class="menu-root">
										<li class="navigation-menu-folder">
					<a class=""
						href="getting_started.html">Getting Started</a></li>
													<li class="navigation-menu-folder">
					<ul>
												<a href="routing/routing.html">Routing</a>
											<li class="navigation-menu-article" style="display:none" >
							<a class=""
								href="routing/routing.html">Routing</a>
						</li>
											<li class="navigation-menu-article" style="display:none" >
							<a class=""
								href="routing/rest.html">REST</a>
						</li>
											<li class="navigation-menu-article" style="display:none" >
							<a class=""
								href="routing/rpc.html">RPC</a>
						</li>
										</ul>
				</li>
													<li class="navigation-menu-folder">
					<ul>
												<a href="request/url_params.html">Request</a>
											<li class="navigation-menu-article" style="display:none" >
							<a class=""
								href="request/url_params.html">URL Params</a>
						</li>
											<li class="navigation-menu-article" style="display:none" >
							<a class=""
								href="request/validation.html">Validation</a>
						</li>
										</ul>
				</li>
													<li class="navigation-menu-folder">
					<ul>
												<a href="response/response.html">Response</a>
											<li class="navigation-menu-article" style="display:none" >
							<a class=""
								href="response/response.html">Response</a>
						</li>
											<li class="navigation-menu-article" style="display:none" >
							<a class=""
								href="response/rendering_template.html">Rendering Template</a>
						</li>
											<li class="navigation-menu-article" style="display:none" >
							<a class=""
								href="response/miscs.html">Miscs</a>
						</li>
										</ul>
				</li>
													<li class="navigation-menu-folder">
					<a class=""
						href="event.html">Event</a></li>
													<li class="navigation-menu-folder">
					<a class=""
						href="component.html">Component</a></li>
													<li class="navigation-menu-folder">
					<a class="current"
						href="middleware.html">Middleware</a></li>
													<li class="navigation-menu-folder">
					<a class=""
						href="helper.html">Helper</a></li>
													<li class="navigation-menu-folder">
					<a class=""
						href="config.html">Config</a></li>
													<li class="navigation-menu-folder">
					<ul>
												<a href="session/session.html">Session</a>
											<li class="navigation-menu-article" style="display:none" >
							<a class=""
								href="session/session.html">Session</a>
						</li>
											<li class="navigation-menu-article" style="display:none" >
							<a class=""
								href="session/user.html">User</a>
						</li>
										</ul>
				</li>
													<li class="navigation-menu-folder">
					<ul>
												<a href="commandline/routing.html">Commandline</a>
											<li class="navigation-menu-article" style="display:none" >
							<a class=""
								href="commandline/routing.html">Routing</a>
						</li>
											<li class="navigation-menu-article" style="display:none" >
							<a class=""
								href="commandline/signal.html">Signal</a>
						</li>
											<li class="navigation-menu-article" style="display:none" >
							<a class=""
								href="commandline/miscs.html">Miscs</a>
						</li>
											<li class="navigation-menu-article" style="display:none" >
							<a class=""
								href="commandline/phar_distribution.html">Phar Distribution</a>
						</li>
										</ul>
				</li>
													<li class="navigation-menu-folder">
					<a class=""
						href="laziness.html">Laziness</a></li>
													<li class="navigation-menu-folder">
					<ul>
												<a href="database/mongodb.html">Database</a>
											<li class="navigation-menu-article" style="display:none" >
							<a class=""
								href="database/mongodb.html">Mongodb</a>
						</li>
											<li class="navigation-menu-article" style="display:none" >
							<a class=""
								href="database/pdo.html">PDO</a>
						</li>
											<li class="navigation-menu-article" style="display:none" >
							<a class=""
								href="database/redis.html">Redis</a>
						</li>
										</ul>
				</li>
													<li class="navigation-menu-folder">
					<a class=""
						href="logging.html">Logging</a></li>
									</ul>

			<ul class="menu-links">
								<li>
					<a href="http://zweifisch.github.io/zf-doc/">Home</a>
				</li>
								<li>
					<a href="https://github.com/zweifisch/zf">GitHub Repo</a>
				</li>
							</ul>

		</div>
		<div class="main-content">
						<h1> Middleware</h1>
						<p>middleware is a way to map a request to multiple functions, samller and more reusable functions</p>

<h2>a middleware for permission controll</h2>

<pre><code class="language-php">$app-&gt;middleware('can', function($args) {
    if(!$this-&gt;user-&gt;can($args)){
        return 403;
    }
});

$app-&gt;delete('/post/:id', 'can:DeletePost', function() {
    return $this-&gt;db-&gt;delete(['_id'=&gt; $id])
});
</code></pre>

<p>same thing without middleware</p>

<pre><code class="language-php">$app-&gt;delete('/post/:id', function($id) {
    // check manually in each handler
    if($this-&gt;user-&gt;canDeletePost) {
        return $this-&gt;db-&gt;delete(['_id'=&gt; $id]);
    }
    return 403;
});
</code></pre>

<h3>middleware as decorators</h3>

<pre><code class="language-php">/**
 * @can DeletePost
 */
return function($id){
    return $this-&gt;db-&gt;delete(['_id'=&gt; $id]);
}
</code></pre>

<h3>writing a middleware</h3>

<p>a middlware for http basic auth</p>

<pre><code class="language-php">$app-&gt;middleware('auth', function($user, $passwd) {
    if($this-&gt;get('PHP_AUTH_USER') != $user
        || $this-&gt;get('PHP_AUTH_PW') != $passwd) {
        $this-&gt;header('WWW-Authenticate', ['Basic realm'=&gt; 'Login Required']);
        $this-&gt;status(401);
        return 'Unauthorized';
    }
});
</code></pre>

<p>If <code>null</code> or a closure is returned from the middleware, the next middleware will be called, otherwise the returned result will be interpreted as the response and the rest middlewares will be skipped.</p>

<p>The closures returned from the middlewares will be called one by one in reversed order once the response is available, and the response will be passed as an argument to those closures, so that the response can be modified.</p>

<p>standalone middlewares should be located in <code>middlewares</code> by default</p>
		</div>
	</div>

	<script type="text/javascript" src="assets/highlight.js"></script>
	<script type="text/javascript">hljs.initHighlightingOnLoad()</script>
</body>
</html>
